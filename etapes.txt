-Pas de required html faire les validations avec javascript (fait)

-Afficher la liste des contacts si on tape etoile dans la barre de recherche dans l'ordre aplhabetique si il y'a deja un message 

-Un numero pour un seul contact sinon impossible de creer (fait)
-Dans messages on affiche la liste de tous les contacts (si il n'y a pas encore de messages)(fait)

-Si on crée un nouveau contact si on recrée un nouveau du meme nom on l'ajoute le numéro un et ainsi de suite prenom 2 , prenom 3 ... (fait)

-Creer notre propre numero (vous meme) connecté avec mon numéro (fait)

-Controle de saisi dans toute l'application 
-Ajout de groupe (minimum 2 personnes) nous somme l'admin du groupe par defaut(fait) 

-A la place des photos de profil ajouter les initiales la première lettre a la place du photo de profil en avec un bgcolor aleatoire 














































































import { createElement } from "./component.js";
import { contacts, groupes } from "./data.js";
import { getContactById, getGroupById } from "./utils.js";

// ===== LISTES ET DISCUSSIONS =====
export function createDiscussionsList(onSelectDiscussion) {
  const allItems = [
    ...contacts
      .filter((contact) => !contact.archive)
      .map((contact) => ({ ...contact, type: "contact" })),
    ...groupes
      .filter((group) => !group.archive)
      .map((group) => ({ ...group, type: "group" })),
  ];

  // Vérifie s'il y a des discussions existantes avec des messages
  const hasDiscussions = allItems.some(
    (item) => item.dernierMessage && item.dernierMessage !== "Nouveau contact"
  );

  // Si pas de discussions, afficher tous les contacts
  const itemsToDisplay = !hasDiscussions
    ? contacts.map((contact) => ({
        ...contact,
        type: "contact",
        dernierMessage: "Cliquez pour démarrer une conversation",
      }))
    : allItems;

  return createElement("div", { className: ["w-full", "h-full", "p-3"] }, [
    createElement(
      "h1",
      { className: ["text-xl", "mb-3"] },
      !hasDiscussions ? "Contacts" : "Discussions"
    ),
    createElement("input", {
      type: "text",
      placeholder: "Rechercher",
      className: [
        "focus:outline-none",
        "w-full",
        "rounded-md",
        "mt-3",
        "p-2",
        "mb-4",
      ],
    }),
    createElement(
      "div",
      { className: ["space-y-2", "overflow-y-auto", "max-h-full"] },
      itemsToDisplay.length > 0
        ? itemsToDisplay.map((item) =>
            createElement(
              "div",
              {
                className: [
                  "flex",
                  "items-center",
                  "p-3",
                  "hover:bg-gray-100",
                  "cursor-pointer",
                  "border-b",
                  "border-gray-200",
                ],
                onclick: () => onSelectDiscussion(item.type, item.id),
              },
              [
                createElement("img", {
                  src: item.photo,
                  alt: item.nom,
                  className: [
                    "w-10",
                    "h-10",
                    "rounded-full",
                    "mr-3",
                    "object-cover",
                  ],
                }),
                createElement("div", { className: ["flex-1"] }, [
                  createElement(
                    "div",
                    { className: ["flex", "justify-between", "items-center"] },
                    [
                      createElement(
                        "h3",
                        { className: ["font-semibold", "text-sm"] },
                        item.nom
                      ),
                      !hasDiscussions
                        ? null
                        : createElement(
                            "span",
                            { className: ["text-xs", "text-gray-500"] },
                            item.heure || ""
                          ),
                    ]
                  ),
                  createElement(
                    "p",
                    {
                      className: [
                        "text-xs",
                        "text-gray-600",
                        "truncate",
                        !hasDiscussions ? "italic" : "",
                      ],
                    },
                    item.type === "group"
                      ? `${item.membres.length} membres`
                      : item.dernierMessage
                  ),
                ]),
              ]
            )
          )
        : createElement(
            "p",
            { className: ["text-gray-500", "text-center", "py-8"] },
            "Aucun contact disponible"
          )
    ),
  ]);
}

export function createArchivesList(onSelectDiscussion, onBack) {
  const archivedItems = [
    ...contacts
      .filter((contact) => contact.archive)
      .map((contact) => ({ ...contact, type: "contact" })),
    ...groupes
      .filter((group) => group.archive)
      .map((group) => ({ ...group, type: "group" })),
  ];

  return createElement("div", { className: ["w-full", "h-full", "p-3"] }, [
    createElement(
      "div",
      { className: ["flex", "justify-between", "items-center", "mb-4"] },
      [
        createElement(
          "h1",
          { className: ["text-xl", "font-bold"] },
          "Discussions archivées"
        ),
        createElement(
          "button",
          {
            className: ["text-gray-500", "hover:text-gray-700", "text-lg"],
            onclick: onBack,
          },
          "← Retour"
        ),
      ]
    ),
    createElement(
      "div",
      { className: ["space-y-2", "overflow-y-auto", "max-h-full"] },
      archivedItems.length > 0
        ? archivedItems.map((item) =>
            createElement(
              "div",
              {
                className: [
                  "flex",
                  "items-center",
                  "p-3",
                  "hover:bg-gray-100",
                  "cursor-pointer",
                  "border-b",
                  "border-gray-200",
                  "bg-gray-50",
                ],
                onclick: () => onSelectDiscussion(item.type, item.id),
              },
              [
                createElement("img", {
                  src: item.photo,
                  alt: item.nom,
                  className: [
                    "w-10",
                    "h-10",
                    "rounded-full",
                    "mr-3",
                    "object-cover",
                    "opacity-70",
                  ],
                }),
                createElement("div", { className: ["flex-1"] }, [
                  createElement(
                    "h3",
                    {
                      className: ["font-semibold", "text-sm", "text-gray-600"],
                    },
                    item.nom
                  ),
                  createElement(
                    "span",
                    {
                      className: ["text-xs", "text-orange-500", "font-medium"],
                    },
                    "Archivé"
                  ),
                ]),
              ]
            )
          )
        : [
            createElement(
              "p",
              { className: ["text-gray-500", "text-center", "py-8"] },
              "Aucune discussion archivée"
            ),
          ]
    ),
  ]);
}

// ===== FORMULAIRES =====
export function createContactForm(onSave, onCancel) {
  return createElement("div", { className: ["w-full", "h-full", "p-4"] }, [
    createElement(
      "div",
      { className: ["flex", "justify-between", "items-center", "mb-6"] },
      [
        createElement(
          "h2",
          { className: ["text-xl", "font-bold"] },
          "Ajouter un contact"
        ),
        createElement(
          "button",
          {
            className: ["text-gray-500", "hover:text-gray-700", "text-xl"],
            onclick: onCancel,
          },
          "×"
        ),
      ]
    ),
    createElement(
      "form",
      {
        className: ["space-y-4"],
        onsubmit: onSave, // Maintenant onSave recevra l'événement
      },
      [
        createElement("input", {
          type: "text",
          placeholder: "Nom du contact",
          className: [
            "w-full",
            "p-3",
            "border",
            "border-gray-300",
            "rounded-md",
            "focus:outline-none",
            "focus:border-blue-500",
            "focus:ring-1",
            "focus:ring-blue-500",
          ],
          id: "contactNom",
        }),
        createElement("input", {
          type: "tel",
          placeholder: "Numéro de téléphone",
          className: [
            "w-full",
            "p-3",
            "border",
            "border-gray-300",
            "rounded-md",
            "focus:outline-none",
            "focus:border-blue-500",
            "focus:ring-1",
            "focus:ring-blue-500",
          ],
          id: "contactTelephone",
        }),
        createElement("input", {
          type: "url",
          placeholder: "URL de la photo (optionnel)",
          className: [
            "w-full",
            "p-3",
            "border",
            "border-gray-300",
            "rounded-md",
            "focus:outline-none",
            "focus:border-blue-500",
            "focus:ring-1",
            "focus:ring-blue-500",
          ],
          id: "contactPhoto",
        }),
        createElement("div", { className: ["flex", "gap-3", "mt-6"] }, [
          createElement(
            "button",
            {
              type: "button",
              className: [
                "px-4",
                "py-2",
                "bg-gray-300",
                "text-gray-700",
                "rounded-md",
                "hover:bg-gray-400",
              ],
              onclick: onCancel,
            },
            "Annuler"
          ),
          createElement(
            "button",
            {
              type: "submit",
              className: [
                "px-4",
                "py-2",
                "bg-blue-500",
                "text-white",
                "rounded-md",
                "hover:bg-blue-600",
              ],
            },
            "Enregistrer"
          ),
        ]),
      ]
    ),
  ]);
}

export function createGroupForm(onSave, onCancel) {
  return createElement("div", { className: ["w-full", "h-full", "p-4"] }, [
    createElement(
      "div",
      { className: ["flex", "justify-between", "items-center", "mb-6"] },
      [
        createElement("h2", { className: ["text-xl", "font-bold"] }, "Créer un groupe"),
        createElement(
          "button",
          {
            className: ["text-gray-500", "hover:text-gray-700", "text-xl"],
            onclick: onCancel,
          },
          "×"
        ),
      ]
    ),
    createElement(
      "form",
      {
        className: ["space-y-4"],
        onsubmit: onSave,
      },
      [
        // Champs existants
        createElement("input", {
          type: "text",
          placeholder: "Nom du groupe",
          className: [
            "w-full",
            "p-3",
            "border",
            "border-gray-300",
            "rounded-md",
            "focus:outline-none",
            "focus:border-blue-500",
          ],
          id: "groupNom",
        }),
        createElement("textarea", {
          placeholder: "Description du groupe",
          className: [
            "w-full",
            "p-3",
            "border",
            "border-gray-300",
            "rounded-md",
            "focus:outline-none",
            "focus:border-blue-500",
            "h-20",
          ],
          id: "groupDescription",
        }),
        createElement("input", {
          type: "url",
          placeholder: "URL de la photo (optionnel)",
          className: [
            "w-full",
            "p-3",
            "border",
            "border-gray-300",
            "rounded-md",
            "focus:outline-none",
            "focus:border-blue-500",
          ],
          id: "groupPhoto",
        }),
        
        // Nouvelle section pour la sélection des membres
        createElement("div", 
          { className: ["mt-4", "border-t", "pt-4"] },
          [
            createElement("h3", 
              { className: ["font-semibold", "mb-2"] },
              "Sélectionnez au moins 2 membres *"
            ),
            createElement("div", 
              { className: ["max-h-48", "overflow-y-auto", "space-y-2", "border", "rounded-md", "p-2"] },
              contacts.map(contact => 
                createElement("div", 
                  { className: ["flex", "items-center", "p-2", "hover:bg-gray-50"] },
                  [
                    createElement("input", {
                      type: "checkbox",
                      id: `member-${contact.id}`,
                      className: ["mr-3", "w-4", "h-4"],
                      name: "members[]",
                      value: contact.id,
                    }),
                    createElement("label", 
                      { 
                        className: ["flex", "items-center", "flex-1", "cursor-pointer"],
                        for: `member-${contact.id}`,
                      },
                      [
                        createElement("img", {
                          src: contact.photo,
                          alt: contact.nom,
                          className: ["w-8", "h-8", "rounded-full", "mr-2"],
                        }),
                        contact.nom
                      ]
                    )
                  ]
                )
              )
            )
          ]
        ),

        // Boutons
        createElement("div", { className: ["flex", "gap-3", "mt-6"] }, [
          createElement(
            "button",
            {
              type: "button",
              className: [
                "px-4",
                "py-2",
                "bg-gray-300",
                "text-gray-700",
                "rounded-md",
                "hover:bg-gray-400",
              ],
              onclick: onCancel,
            },
            "Annuler"
          ),
          createElement(
            "button",
            {
              type: "submit",
              className: [
                "px-4",
                "py-2",
                "bg-blue-500",
                "text-white",
                "rounded-md",
                "hover:bg-blue-600",
              ],
            },
            "Créer"
          ),
        ]),
      ]
    ),
  ]);
}

// ===== AUTRES VUES =====
export function createContactsList(onBack) {
  return createElement("div", { className: ["w-full", "h-full", "p-4"] }, [
    createElement(
      "div",
      { className: ["flex", "justify-between", "items-center", "mb-4"] },
      [
        createElement(
          "h2",
          { className: ["text-xl", "font-bold"] },
          "Contacts"
        ),
        createElement(
          "button",
          {
            className: ["text-gray-500", "hover:text-gray-700", "text-lg"],
            onclick: onBack,
          },
          "← Retour"
        ),
      ]
    ),
    createElement(
      "div",
      { className: ["space-y-2", "overflow-y-auto", "max-h-full"] },
      contacts.map((contact) =>
        createElement(
          "div",
          {
            className: [
              "flex",
              "items-center",
              "p-3",
              "hover:bg-gray-100",
              "cursor-pointer",
              "border-b",
              "border-gray-200",
            ],
          },
          [
            createElement("img", {
              src: contact.photo,
              alt: contact.nom,
              className: [
                "w-10",
                "h-10",
                "rounded-full",
                "mr-3",
                "object-cover",
              ],
            }),
            createElement("div", { className: ["flex-1"] }, [
              createElement(
                "h3",
                { className: ["font-semibold"] },
                contact.nom
              ),
              createElement(
                "p",
                { className: ["text-sm", "text-gray-600"] },
                contact.telephone
              ),
            ]),
          ]
        )
      )
    ),
  ]);
}

export function createGroupsList(onBack, onGroupSelect, onCreateGroup) {
  return createElement("div", { className: ["w-full", "h-full", "p-4", "relative"] }, [
    createElement(
      "div",
      { className: ["flex", "justify-between", "items-center", "mb-4"] },
      [
        createElement("h2", { className: ["text-xl", "font-bold"] }, "Groupes"),
        createElement(
          "button",
          {
            className: ["text-gray-500", "hover:text-gray-700", "text-lg"],
            onclick: onBack,
          },
          "← Retour"
        ),
      ]
    ),
    createElement(
      "div",
      { className: ["space-y-2", "overflow-y-auto", "max-h-[calc(100%-100px)]"] },
      groupes.map((group) =>
        createElement(
          "div",
          {
            className: [
              "flex",
              "items-center",
              "p-3",
              "hover:bg-gray-100",
              "cursor-pointer",
              "border-b",
              "border-gray-200",
            ],
            onclick: () => onGroupSelect(group.id),
          },
          [
            createElement("img", {
              src: group.photo,
              alt: group.nom,
              className: [
                "w-10",
                "h-10",
                "rounded-full",
                "mr-3",
                "object-cover",
              ],
            }),
            createElement("div", { className: ["flex-1"] }, [
              createElement("h3", { className: ["font-semibold"] }, group.nom),
              createElement(
                "p",
                { className: ["text-sm", "text-gray-600"] },
                `${group.membres.length} membres`
              ),
            ]),
          ]
        )
      )
    ),
    // Modifier le bouton d'ajout de groupe
    createElement(
      "button",
      {
        className: [
          "absolute",
          "bottom-4",
          "right-4",
          "w-12",
          "h-12",
          "bg-orange-500",
          "text-white",
          "rounded-full",
          "flex",
          "items-center",
          "justify-center",
          "shadow-lg",
          "hover:bg-orange-600",
          "transition-colors",
        ],
        onclick: onCreateGroup, // Utiliser le paramètre passé
      },
      [createElement("i", { className: ["fa-solid", "fa-plus", "text-xl"] })]
    ),
  ]);
}

export function createGroupDetails(groupId, onBack, onAddMembers) {
  const group = getGroupById(groupId);
  const membresDetails = group.membres.map(membre => ({
    ...getContactById(membre.id),
    role: membre.role
  }));

  return createElement("div", { className: ["w-full", "h-full", "p-4"] }, [
    createElement(
      "div",
      { className: ["flex", "justify-between", "items-center", "mb-4"] },
      [
        createElement("h2", { className: ["text-xl", "font-bold"] }, group.nom),
        createElement(
          "button",
          {
            className: ["text-gray-500", "hover:text-gray-700", "text-lg"],
            onclick: onBack,
          },
          "← Retour"
        ),
      ]
    ),
    createElement(
      "div",
      { className: ["mb-4", "p-3", "bg-gray-50", "rounded-md"] },
      [
        createElement(
          "p",
          { className: ["text-sm", "text-gray-600", "mb-2"] },
          group.description
        ),
        createElement(
          "p",
          { className: ["text-sm", "font-semibold"] },
          `${group.membres.length} membres`
        ),
      ]
    ),
    createElement(
      "button",
      {
        className: [
          "w-full",
          "p-2",
          "bg-blue-500",
          "text-white",
          "rounded-md",
          "hover:bg-blue-600",
          "mb-4",
        ],
        onclick: () => onAddMembers(groupId),
      },
      "Ajouter des membres"
    ),
    createElement(
      "div",
      { className: ["space-y-2", "overflow-y-auto", "max-h-full"] },
      membresDetails.map((membre) =>
        createElement(
          "div",
          {
            className: [
              "flex",
              "items-center",
              "p-3",
              "border-b",
              "border-gray-200",
            ],
          },
          [
            createElement("img", {
              src: membre.photo,
              alt: membre.nom,
              className: ["w-8", "h-8", "rounded-full", "mr-3", "object-cover"],
            }),
            createElement("div", { className: ["flex-1"] }, [
              createElement(
                "div",
                { className: ["flex", "items-center", "gap-2"] },
                [
                  createElement(
                    "h4",
                    { className: ["font-semibold", "text-sm"] },
                    membre.nom
                  ),
                  membre.role === "admin" && 
                  createElement(
                    "span",
                    {
                      className: [
                        "text-xs",
                        "bg-blue-100",
                        "text-blue-800",
                        "px-2",
                        "py-0.5",
                        "rounded-full",
                      ],
                    },
                    "Admin"
                  ),
                ]
              ),
              createElement(
                "p",
                { className: ["text-xs", "text-gray-600"] },
                membre.telephone
              ),
            ]),
          ]
        )
      )
    ),
  ]);
}

export function createAddMemberForm(groupId, onBack, onSave) {
  const group = getGroupById(groupId);
  const availableContacts = contacts.filter(
    (contact) => !group.membres.includes(contact.id)
  );

  return createElement("div", { className: ["w-full", "h-full", "p-4"] }, [
    createElement(
      "div",
      { className: ["flex", "justify-between", "items-center", "mb-6"] },
      [
        createElement(
          "h2",
          { className: ["text-xl", "font-bold"] },
          `Ajouter des membres à ${group.nom}`
        ),
        createElement(
          "button",
          {
            className: ["text-gray-500", "hover:text-gray-700", "text-xl"],
            onclick: onBack,
          },
          "×"
        ),
      ]
    ),
    createElement(
      "div",
      { className: ["space-y-2"] },
      availableContacts.length > 0
        ? availableContacts.map((contact) =>
            createElement(
              "div",
              {
                className: [
                  "flex",
                  "items-center",
                  "p-3",
                  "border",
                  "rounded-md",
                  "hover:bg-gray-50",
                ],
              },
              [
                createElement("input", {
                  type: "checkbox",
                  id: `contact-${contact.id}`,
                  className: ["mr-3"],
                }),
                createElement("img", {
                  src: contact.photo,
                  alt: contact.nom,
                  className: [
                    "w-8",
                    "h-8",
                    "rounded-full",
                    "mr-3",
                    "object-cover",
                  ],
                }),
                createElement(
                  "label",
                  {
                    for: `contact-${contact.id}`,
                    className: ["flex-1", "cursor-pointer"],
                  },
                  `${contact.nom} (${contact.telephone})`
                ),
              ]
            )
          )
        : [
            createElement(
              "p",
              { className: ["text-gray-500", "text-center", "py-8"] },
              "Tous les contacts sont déjà dans ce groupe"
            ),
          ]
    ),
    availableContacts.length > 0
      ? createElement("div", { className: ["flex", "gap-3", "mt-6"] }, [
          createElement(
            "button",
            {
              type: "button",
              className: [
                "px-4",
                "py-2",
                "bg-gray-300",
                "text-gray-700",
                "rounded-md",
                "hover:bg-gray-400",
              ],
              onclick: onBack,
            },
            "Annuler"
          ),
          createElement(
            "button",
            {
              type: "button",
              className: [
                "px-4",
                "py-2",
                "bg-blue-500",
                "text-white",
                "rounded-md",
                "hover:bg-blue-600",
              ],
              onclick: onSave,
            },
            "Ajouter les membres sélectionnés"
          ),
        ])
      : null,
  ]);
}

export function createDiffusionList(onBack) {
  return createElement("div", { className: ["w-full", "h-full", "p-4"] }, [
    createElement(
      "div",
      { className: ["flex", "justify-between", "items-center", "mb-4"] },
      [
        createElement(
          "h2",
          { className: ["text-xl", "font-bold"] },
          "Liste de diffusion"
        ),
        createElement(
          "button",
          {
            className: ["text-gray-500", "hover:text-gray-700", "text-lg"],
            onclick: onBack,
          },
          "← Retour"
        ),
      ]
    ),
    createElement(
      "div",
      { className: ["space-y-2", "overflow-y-auto", "max-h-full"] },
      contacts.map((contact) =>
        createElement(
          "div",
          {
            className: [
              "flex",
              "items-center",
              "p-3",
              "hover:bg-orange-50",
              "cursor-pointer",
              "border-b",
              "border-orange-200",
            ],
          },
          [
            createElement("input", {
              type: "checkbox",
              id: `diffusion-${contact.id}`,
              className: ["mr-3", "w-4", "h-4", "accent-orange-500"],
            }),
            createElement("img", {
              src: contact.photo,
              alt: contact.nom,
              className: [
                "w-10",
                "h-10",
                "rounded-full",
                "mr-3",
                "object-cover",
              ],
            }),
            createElement(
              "div",
              {
                className: [
                  "flex-1",
                  "border-b",
                  "border-orange-500",
                ],
              },
              [
                createElement(
                  "h3",
                  { className: ["font-semibold"] },
                  contact.nom
                ),
                createElement(
                  "p",
                  { className: ["text-sm", "text-gray-600"] },
                  contact.telephone
                ),
              ]
            ),
          ]
        )
      )
    ),
  ]);
}
